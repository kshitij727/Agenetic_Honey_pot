openapi: 3.0.0
info:
  title: Agentic Honey-Pot API
  description: |
    National-level API for scam detection and autonomous scammer engagement.
    This system detects scam intent and engages scammers to extract actionable intelligence.
  version: 1.0.0
  contact:
    name: Cyber Security Team
    email: security@gov.in
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api/v1
    description: Local development server
  - url: https://api.honeypot.security.gov.in/api/v1
    description: Production server

security:
  - ApiKeyAuth: []

paths:
  /health:
    get:
      summary: Health check endpoint
      description: Check if the API is running and healthy
      security: []
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: 1.0.0
                  uptime:
                    type: number
                    example: 3600

  /process-message:
    post:
      summary: Process incoming message
      description: |
        Main endpoint for processing scam messages. Analyzes the message,
        detects scam intent, and engages AI agent if scam is detected.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageRequest'
            examples:
              firstMessage:
                summary: First message in conversation
                value:
                  sessionId: "abc-123-session"
                  message:
                    sender: "scammer"
                    text: "Your bank account will be blocked today. Verify immediately."
                    timestamp: "2026-01-21T10:15:30Z"
                  conversationHistory: []
                  metadata:
                    channel: "SMS"
                    language: "English"
                    locale: "IN"
              followUpMessage:
                summary: Follow-up message
                value:
                  sessionId: "abc-123-session"
                  message:
                    sender: "scammer"
                    text: "Share your UPI ID to avoid account suspension."
                    timestamp: "2026-01-21T10:17:10Z"
                  conversationHistory:
                    - sender: "scammer"
                      text: "Your bank account will be blocked today. Verify immediately."
                      timestamp: "2026-01-21T10:15:30Z"
                    - sender: "user"
                      text: "Why will my account be blocked?"
                      timestamp: "2026-01-21T10:16:10Z"
                  metadata:
                    channel: "SMS"
                    language: "English"
                    locale: "IN"
      responses:
        '200':
          description: Message processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /session/{sessionId}:
    get:
      summary: Get session status
      description: Retrieve information about a specific session
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
          description: Unique session identifier
      responses:
        '200':
          description: Session information retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  session:
                    type: object
                    properties:
                      sessionId:
                        type: string
                      isAgentActive:
                        type: boolean
                      messageCount:
                        type: integer
                      scamDetected:
                        type: boolean
                      intelligence:
                        type: object
                      createdAt:
                        type: string
                        format: date-time
                      lastActivity:
                        type: string
                        format: date-time
        '404':
          description: Session not found

  /session/{sessionId}/end:
    post:
      summary: End session and send callback
      description: Force end a session and send final callback to GUVI
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Session ended successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  callbackResult:
                    type: object

  /statistics:
    get:
      summary: Get system statistics
      description: Retrieve overall system statistics and metrics
      responses:
        '200':
          description: Statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  statistics:
                    type: object
                    properties:
                      total:
                        type: integer
                      active:
                        type: integer
                      ended:
                        type: integer
                      scamDetected:
                        type: integer
                      agentActive:
                        type: integer
                      totalMessages:
                        type: integer
                      averageMessagesPerSession:
                        type: number
                      timestamp:
                        type: string
                        format: date-time

  /batch-process:
    post:
      summary: Batch process messages
      description: Process multiple messages in a single request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                messages:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      text:
                        type: string
      responses:
        '200':
          description: Batch processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        messageId:
                          type: string
                        scamDetected:
                          type: boolean
                        confidence:
                          type: number
                        intent:
                          type: string

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key for authentication

  schemas:
    MessageRequest:
      type: object
      required:
        - sessionId
        - message
      properties:
        sessionId:
          type: string
          description: Unique identifier for the conversation session
          example: "abc-123-session"
        message:
          type: object
          required:
            - sender
            - text
            - timestamp
          properties:
            sender:
              type: string
              enum: [scammer, user]
              description: Who sent the message
            text:
              type: string
              description: The message content
              maxLength: 5000
            timestamp:
              type: string
              format: date-time
              description: ISO 8601 timestamp
        conversationHistory:
          type: array
          description: Previous messages in the conversation
          items:
            type: object
            properties:
              sender:
                type: string
                enum: [scammer, user]
              text:
                type: string
              timestamp:
                type: string
                format: date-time
        metadata:
          type: object
          properties:
            channel:
              type: string
              enum: [SMS, WhatsApp, Email, Chat]
              default: Chat
            language:
              type: string
              default: English
            locale:
              type: string
              default: IN

    MessageResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        reply:
          type: string
          description: AI agent's response (null if no scam detected)
          nullable: true
        scamDetected:
          type: boolean
          description: Whether scam was detected
        confidence:
          type: number
          description: Confidence score (0-1)
          minimum: 0
          maximum: 1
        intent:
          type: string
          description: Detected scam intent type

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string
